package net.mcreator.enhancing.procedures;
import net.mcreator.enhancing.block.CoalFurnaceBlock;

import net.minecraftforge.registries.ForgeRegistries;
import net.minecraftforge.items.IItemHandlerModifiable;
import net.minecraftforge.common.capabilities.ForgeCapabilities;

import net.minecraft.world.level.block.entity.BlockEntity;
import net.minecraft.world.level.block.Blocks;
import net.minecraft.world.level.LevelAccessor;
import net.minecraft.world.level.Level;
import net.minecraft.world.item.ItemStack;
import net.minecraft.sounds.SoundSource;
import net.minecraft.resources.ResourceLocation;
import net.minecraft.core.BlockPos;

import java.util.concurrent.atomic.AtomicReference;
import java.util.concurrent.atomic.AtomicInteger;
import net.minecraft.world.level.block.state.BlockState;

public class CoalFurnaceUpdateTickProcedure
{
	// Returns the ItemStack contained inside a given slot of a given block entity.
	public static ItemStack retrieveItemStack(BlockEntity _blockEntity, int _slotId)
	{
		if (_blockEntity == null)
		{
			return ItemStack.EMPTY;
		}

		AtomicReference<ItemStack> _retrieved = new AtomicReference<>(ItemStack.EMPTY);
		_blockEntity.getCapability(ForgeCapabilities.ITEM_HANDLER, null).ifPreset(
			_capability ->
			{
				_retrieved.set(_capability.getStackInSlot(_slotId).copy());
			}
		);

		return _retrieved.get();
	}

	// Returns the number of item in a given slot of a given block entity. Returns 0 in
	// case the block entity is null, or in case the slot has an empty stack.
	public static int retrieveItemCount(BlockEntity _blockEntity, int _slotId)
	{
		ItemStack _stack = retrieveItemStack(_blockEntity, _slotId);
		return (_stack != null) ? _stack.getCount() : 0;
	}

	// Returns whether the given slot of a given block entity contains an empty stack or not.
	public static boolean isSlotEmpty(BlockEntity _blockEntity, int _slotId)
	{
		return retrieveItemStack(_blockEntity, _slotId) == ItemStack.EMPTY;
	}

	// Chooses whether it should return or not the correct item in the coal furnace, depending on when it started,
	// and when it stopped (_stopTime and _startTime).
	public static void onCoalFurnaceStops(BlockPos _position, Level _level, long _stopTime, long _startTime)
	{
		
	}

	public static void onCoalFurnaceTick(LevelAccessor _world, BlockPos _blockPos, BlockState _blockstate)
	{
		BlockEntity _blockEntity = _world.getBlockEntity(_blockPos);

		if (_blockEntity == null)
		{
			return;
		}

		// Combustible and log type checks are done inside the CoalFurnaceGUIMenu.java class, so we
		// don't need to bother checking whether it's the right materials being put inside the furnace
		// here.
		boolean _isFurnaceFilledWithWood = (isSlotEmpty(_blockEntity, 0) == false);
		boolean _isFurnaceFilledWithCombustible = (isSlotEmpty(_blockEntity, 1) == false);

		if (_isFurnaceFilledWithCombustible == false || _isFurnaceFilledWithWood == false)
		{
			return;
		}

		if (CoalFurnaceBlock.isBurning(_blockPos))
		{
			
		}
	
		if (new Object() {
			public int getAmount(LevelAccessor world, BlockPos pos, int slotid) {
				AtomicInteger _retval = new AtomicInteger(0);
				BlockEntity _ent = world.getBlockEntity(pos);
				if (_ent != null)
					_ent.getCapability(ForgeCapabilities.ITEM_HANDLER, null).ifPresent(capability -> _retval.set(capability.getStackInSlot(slotid).getCount()));
				return _retval.get();
			}
		}.getAmount(world, new BlockPos(x, y, z), 2) < 64 && (new Object() {
			public ItemStack getItemStack(LevelAccessor world, BlockPos pos, int slotid) {
				AtomicReference<ItemStack> _retval = new AtomicReference<>(ItemStack.EMPTY);
				BlockEntity _ent = world.getBlockEntity(pos);
				if (_ent != null)
					_ent.getCapability(ForgeCapabilities.ITEM_HANDLER, null).ifPresent(capability -> _retval.set(capability.getStackInSlot(slotid).copy()));
				return _retval.get();
			}
		}.getItemStack(world, new BlockPos(x, y, z), 0)).getItem() == Blocks.COPPER_ORE.asItem() && (new Object() {
			public ItemStack getItemStack(LevelAccessor world, BlockPos pos, int slotid) {
				AtomicReference<ItemStack> _retval = new AtomicReference<>(ItemStack.EMPTY);
				BlockEntity _ent = world.getBlockEntity(pos);
				if (_ent != null)
					_ent.getCapability(ForgeCapabilities.ITEM_HANDLER, null).ifPresent(capability -> _retval.set(capability.getStackInSlot(slotid).copy()));
				return _retval.get();
			}
		}.getItemStack(world, new BlockPos(x, y, z), 1)).getItem() == Blocks.WAXED_EXPOSED_CUT_COPPER_SLAB.asItem() && (new Object() {
			public int getAmount(LevelAccessor world, BlockPos pos, int slotid) {
				AtomicInteger _retval = new AtomicInteger(0);
				BlockEntity _ent = world.getBlockEntity(pos);
				if (_ent != null)
					_ent.getCapability(ForgeCapabilities.ITEM_HANDLER, null).ifPresent(capability -> _retval.set(capability.getStackInSlot(slotid).getCount()));
				return _retval.get();
			}
		}.getAmount(world, new BlockPos(x, y, z), 2) <= 63 && (new Object() {
			public ItemStack getItemStack(LevelAccessor world, BlockPos pos, int slotid) {
				AtomicReference<ItemStack> _retval = new AtomicReference<>(ItemStack.EMPTY);
				BlockEntity _ent = world.getBlockEntity(pos);
				if (_ent != null)
					_ent.getCapability(ForgeCapabilities.ITEM_HANDLER, null).ifPresent(capability -> _retval.set(capability.getStackInSlot(slotid).copy()));
				return _retval.get();
			}
		}.getItemStack(world, new BlockPos(x, y, z), 2)).getItem() == Blocks.OXIDIZED_COPPER.asItem() || (new Object() {
			public ItemStack getItemStack(LevelAccessor world, BlockPos pos, int slotid) {
				AtomicReference<ItemStack> _retval = new AtomicReference<>(ItemStack.EMPTY);
				BlockEntity _ent = world.getBlockEntity(pos);
				if (_ent != null)
					_ent.getCapability(ForgeCapabilities.ITEM_HANDLER, null).ifPresent(capability -> _retval.set(capability.getStackInSlot(slotid).copy()));
				return _retval.get();
			}
		}.getItemStack(world, new BlockPos(x, y, z), 2)).getItem() == Blocks.WAXED_WEATHERED_CUT_COPPER.asItem())) {
			{
				BlockEntity _ent = world.getBlockEntity(new BlockPos(x, y, z));
				if (_ent != null) {
					final int _slotid = 0;
					final int _amount = 1;
					_ent.getCapability(ForgeCapabilities.ITEM_HANDLER, null).ifPresent(capability -> {
						if (capability instanceof IItemHandlerModifiable) {
							ItemStack _stk = capability.getStackInSlot(_slotid).copy();
							_stk.shrink(_amount);
							((IItemHandlerModifiable) capability).setStackInSlot(_slotid, _stk);
						}
					});
				}
			}
			{
				BlockEntity _ent = world.getBlockEntity(new BlockPos(x, y, z));
				if (_ent != null) {
					final int _slotid = 1;
					final int _amount = 1;
					_ent.getCapability(ForgeCapabilities.ITEM_HANDLER, null).ifPresent(capability -> {
						if (capability instanceof IItemHandlerModifiable) {
							ItemStack _stk = capability.getStackInSlot(_slotid).copy();
							_stk.shrink(_amount);
							((IItemHandlerModifiable) capability).setStackInSlot(_slotid, _stk);
						}
					});
				}
			}
			{
				BlockEntity _ent = world.getBlockEntity(new BlockPos(x, y, z));
				if (_ent != null) {
					final int _slotid = 2;
					final ItemStack _setstack = new ItemStack(Blocks.OXIDIZED_COPPER);
					_setstack.setCount((int) (new Object() {
						public int getAmount(LevelAccessor world, BlockPos pos, int slotid) {
							AtomicInteger _retval = new AtomicInteger(0);
							BlockEntity _ent = world.getBlockEntity(pos);
							if (_ent != null)
								_ent.getCapability(ForgeCapabilities.ITEM_HANDLER, null).ifPresent(capability -> _retval.set(capability.getStackInSlot(slotid).getCount()));
							return _retval.get();
						}
					}.getAmount(world, new BlockPos(x, y, z), 2) + 1));
					_ent.getCapability(ForgeCapabilities.ITEM_HANDLER, null).ifPresent(capability -> {
						if (capability instanceof IItemHandlerModifiable)
							((IItemHandlerModifiable) capability).setStackInSlot(_slotid, _setstack);
					});
				}
			}
			if (world instanceof Level _level) {
				if (!_level.isClientSide()) {
					_level.playSound(null, new BlockPos(x, y, z), ForgeRegistries.SOUND_EVENTS.getValue(new ResourceLocation("block.furnace.fire_crackle")), SoundSource.BLOCKS, 1, 1);
				} else {
					_level.playLocalSound(x, y, z, ForgeRegistries.SOUND_EVENTS.getValue(new ResourceLocation("block.furnace.fire_crackle")), SoundSource.BLOCKS, 1, 1, false);
				}
			}
		}
	}
}
